-- Raw data to give to Excel to generate the pivot table
-- TODO: currently the generator only creates the case-when clauses and not
-- the entire thing. Change this so that it totally generated
SELECT
  CASE
    WHEN p.score BETWEEN 1 AND 10 THEN '1-10'
    WHEN p.score BETWEEN 11 AND 20 THEN '11-20'
    WHEN p.score BETWEEN 21 AND 30 THEN '21-30'
    WHEN p.score BETWEEN 31 AND 40 THEN '31-40'
    WHEN p.score BETWEEN 41 AND 50 THEN '41-50'
    WHEN p.score BETWEEN 51 AND 60 THEN '51-60'
    WHEN p.score BETWEEN 61 AND 70 THEN '61-70'
    WHEN p.score BETWEEN 71 AND 80 THEN '71-80'
    WHEN p.score BETWEEN 81 AND 90 THEN '81-90'
    WHEN p.score BETWEEN 91 AND 100 THEN '91-100'
    WHEN p.score BETWEEN 101 AND 110 THEN '101-110'
    WHEN p.score BETWEEN 111 AND 120 THEN '111-120'
    WHEN p.score BETWEEN 121 AND 130 THEN '121-130'
    WHEN p.score BETWEEN 131 AND 140 THEN '131-140'
    WHEN p.score BETWEEN 141 AND 150 THEN '141-150'
    WHEN p.score BETWEEN 151 AND 160 THEN '151-160'
    WHEN p.score BETWEEN 161 AND 170 THEN '161-170'
    WHEN p.score BETWEEN 171 AND 180 THEN '171-180'
    WHEN p.score BETWEEN 181 AND 190 THEN '181-190'
    WHEN p.score BETWEEN 191 AND 200 THEN '191-200'
    WHEN p.score BETWEEN 201 AND 210 THEN '201-210'
    WHEN p.score BETWEEN 211 AND 220 THEN '211-220'
    WHEN p.score BETWEEN 221 AND 230 THEN '221-230'
    WHEN p.score BETWEEN 231 AND 240 THEN '231-240'
    WHEN p.score BETWEEN 241 AND 250 THEN '241-250'
    WHEN p.score BETWEEN 251 AND 260 THEN '251-260'
    WHEN p.score BETWEEN 261 AND 270 THEN '261-270'
    WHEN p.score BETWEEN 271 AND 280 THEN '271-280'
    WHEN p.score BETWEEN 281 AND 290 THEN '281-290'
    WHEN p.score BETWEEN 291 AND 300 THEN '291-300'
    WHEN p.score BETWEEN 301 AND 310 THEN '301-310'
    ELSE 'n > 310' END AS score_group,
  CASE
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 1 AND 50 THEN '1-50'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 51 AND 100 THEN '51-100'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 101 AND 150 THEN '101-150'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 151 AND 200 THEN '151-200'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 201 AND 250 THEN '201-250'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 251 AND 300 THEN '251-300'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 301 AND 350 THEN '301-350'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 351 AND 400 THEN '351-400'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 401 AND 450 THEN '401-450'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 451 AND 500 THEN '451-500'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 501 AND 550 THEN '501-550'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 551 AND 600 THEN '551-600'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 601 AND 650 THEN '601-650'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 651 AND 700 THEN '651-700'
    WHEN CHAR_LENGTH(p.content_text) BETWEEN 701 AND 750 THEN '701-750'
    ELSE 'n > 750' END AS length_group,
  _id AS ID,
  CHAR_LENGTH(p.content_text) AS text_length,
  p.score as score
FROM posts p
INTO OUTFILE '/var/lib/mysql-files/pivot.csv'
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
ESCAPED BY '"'
LINES TERMINATED BY '\n'
